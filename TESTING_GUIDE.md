# Керівництво з тестування взаємодії сервера та мобільного додатка

## Огляд системи

Система автосервісу складається з:
- **Backend сервер** (Node.js + Express + Supabase)
- **Мобільний додаток** (React Native + Expo)
- **Автоматичні сповіщення** (Cron jobs + Push notifications)

## Запуск системи

### 1. Запуск сервера
```bash
cd server
npm install
npm start
```
Сервер запуститься на `http://localhost:3000`

### 2. Запуск мобільного додатка
```bash
cd mobile
npm install
npx expo start
```

## Тестування API endpoints

### Аутентифікація
- `POST /api/auth/register` - реєстрація користувача
- `POST /api/auth/login` - вхід користувача
- `POST /api/auth/logout` - вихід користувача

### Транспортні засоби
- `GET /api/vehicles` - отримання списку авто користувача
- `POST /api/vehicles` - додавання нового авто
- `PUT /api/vehicles/:id` - оновлення даних авто
- `DELETE /api/vehicles/:id` - видалення авто

### Записи на сервіс
- `GET /api/appointments` - отримання записів користувача
- `POST /api/appointments` - створення нового запису
- `PUT /api/appointments/:id` - оновлення запису
- `DELETE /api/appointments/:id` - скасування запису

### Нагадування
- `GET /api/reminders` - отримання нагадувань користувача
- `POST /api/reminders` - створення нагадування
- `PUT /api/reminders/:id` - оновлення нагадування
- `DELETE /api/reminders/:id` - видалення нагадування

### Сповіщення
- `GET /api/notifications` - отримання сповіщень користувача
- `POST /api/notifications/mark-read/:id` - позначити як прочитане
- `POST /api/notifications/mark-all-read` - позначити всі як прочитані

## Тестування push-сповіщень

### 1. Реєстрація пристрою
```javascript
// В мобільному додатку
import { registerForPushNotificationsAsync } from './api/notificationsService';

// Викликати при вході користувача
await registerForPushNotificationsAsync();
```

### 2. Тестування автоматичних нагадувань
1. Створіть нагадування з датою на завтра
2. Планувальник автоматично відправить push-сповіщення
3. Перевірте отримання сповіщення в додатку

## Тестування функціональності

### Сценарій 1: Реєстрація та вхід
1. Відкрийте мобільний додаток
2. Зареєструйте нового користувача
3. Увійдіть в систему
4. Перевірте, що токен збережено

### Сценарій 2: Додавання транспортного засобу
1. Увійдіть в додаток
2. Перейдіть до розділу "Мої авто"
3. Додайте новий автомобіль
4. Перевірте, що дані збережено на сервері

### Сценарій 3: Створення запису на сервіс
1. Виберіть автомобіль
2. Створіть новий запис на сервіс
3. Перевірте, що запис відображається в списку
4. Перевірте отримання push-сповіщення

### Сценарій 4: Нагадування про ТО
1. Створіть нагадування про ТО
2. Встановіть дату на завтра
3. Дочекайтесь автоматичного сповіщення
4. Перевірте, що сповіщення з'явилось в додатку

## Налагодження

### Перевірка логів сервера
```bash
# Логи сервера виводяться в консоль
# Перевірте наявність помилок підключення до Supabase
```

### Перевірка мобільного додатка
```bash
# Використовуйте Expo DevTools для перегляду логів
# Перевірте мережеві запити в Network tab
```

### Перевірка push-сповіщень
1. Переконайтесь, що Expo push token отримано
2. Перевірте, що токен збережено в базі даних
3. Перевірте логи планувальника нагадувань

## Структура бази даних

### Основні таблиці:
- `users` - користувачі
- `vehicles` - транспортні засоби
- `appointments` - записи на сервіс
- `reminders` - нагадування
- `notifications` - сповіщення
- `push_tokens` - токени для push-сповіщень

## Автоматичні процеси

### Планувальник нагадувань
- Запускається кожні 30 хвилин
- Перевіряє нагадування на наступні 24 години
- Відправляє push-сповіщення
- Створює повторювані нагадування

### Push-сповіщення
- Використовує Expo Push Notifications
- Підтримує групову відправку
- Включає обробку помилок та повторні спроби

## Поради з тестування

1. **Використовуйте реальний пристрій** для тестування push-сповіщень
2. **Перевіряйте мережеві запити** в DevTools
3. **Моніторте логи сервера** для виявлення помилок
4. **Тестуйте різні сценарії** (успішні та з помилками)
5. **Перевіряйте синхронізацію даних** між додатком та сервером

## Відомі проблеми та рішення

### Проблема: Push-сповіщення не приходять
**Рішення:**
- Перевірте, що Expo push token отримано
- Переконайтесь, що дозволи на сповіщення надано
- Перевірте логи сервера на помилки відправки

### Проблема: Помилки автентифікації
**Рішення:**
- Перевірте налаштування Supabase
- Переконайтесь, що токени не застаріли
- Перевірте правильність API ключів

### Проблема: Дані не синхронізуються
**Рішення:**
- Перевірте мережеве з'єднання
- Переконайтесь, що сервер запущено
- Перевірте правильність URL в конфігурації додатка