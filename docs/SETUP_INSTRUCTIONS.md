# Інструкції з налаштування та тестування системи

## 1. Налаштування Supabase

### Крок 1: Виконання SQL скрипта
1. Відкрийте Supabase Dashboard: https://supabase.com/dashboard
2. Перейдіть до вашого проекту
3. Відкрийте SQL Editor (ліва панель)
4. Скопіюйте весь вміст файлу `SUPABASE_SETUP.sql`
5. Вставте в SQL Editor та натисніть "Run"
6. Переконайтеся, що всі команди виконались без помилок

### Крок 2: Перевірка створених таблиць
Виконайте в SQL Editor:
```sql
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN ('users', 'vehicles', 'mileage_requests');
```

Повинні з'явитися всі три таблиці.

### Крок 3: Перевірка тестового користувача
Виконайте в SQL Editor:
```sql
SELECT id, email, name, role, created_at 
FROM public.users 
WHERE email = 'test@example.com';
```

Повинен з'явитися тестовий користувач.

## 2. Тестування серверної частини

### Крок 1: Запуск сервера
```bash
cd server
npm start
```

Сервер повинен запуститися на порту 3000.

### Крок 2: Тестування реєстрації (якщо потрібно)
```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"newuser@example.com","password":"password123","role":"client"}'
```

### Крок 3: Тестування входу
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test123"}'
```

Очікуваний результат:
```json
{
  "access_token": "eyJ...",
  "user": {
    "id": "...",
    "email": "test@example.com",
    "role": "client",
    "twoFactorEnabled": false
  }
}
```

### Крок 4: Тестування отримання даних користувача
Використайте токен з попереднього кроку:
```bash
curl -X GET http://localhost:3000/api/auth/me \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

## 3. Тестування мобільного додатку

### Крок 1: Очищення кешу
1. Закрийте додаток повністю
2. Очистіть кеш Expo Go (якщо використовуєте)
3. Перезапустіть Metro Bundler:
```bash
cd mobile
npx expo start --clear
```

### Крок 2: Тестування входу
1. Відкрийте додаток
2. Перейдіть на екран входу
3. Введіть:
   - Email: `test@example.com`
   - Пароль: `test123`
4. Натисніть "Увійти"

### Крок 3: Перевірка даних користувача
1. Після успішного входу перейдіть на екран профілю
2. Переконайтеся, що відображаються правильні дані:
   - Ім'я: "Тестовий Користувач"
   - Email: "test@example.com"
   - Роль: "client"

## 4. Діагностика проблем

### Проблема: "Користувача не знайдено"
**Рішення:**
1. Перевірте, чи виконався SQL скрипт в Supabase
2. Перевірте, чи створився тестовий користувач
3. Перевірте правильність email та пароля

### Проблема: "Could not find the 'password' column"
**Рішення:**
1. Переконайтеся, що таблиця `users` створена з правильною структурою
2. Виконайте SQL скрипт повторно
3. Перевірте права доступу SERVICE_ROLE_KEY

### Проблема: "Токен недійсний"
**Рішення:**
1. Перевірте правильність JWT_SECRET в .env файлі
2. Переконайтеся, що токен передається в правильному форматі
3. Перевірте, чи не закінчився термін дії токена

### Проблема: Помилки з'єднання з Supabase
**Рішення:**
1. Перевірте SUPABASE_URL та SUPABASE_SERVICE_ROLE_KEY в .env
2. Переконайтеся, що ключі правильні та активні
3. Перевірте інтернет-з'єднання

## 5. Логування та моніторинг

### Сервер
Логи сервера відображаються в консолі. Шукайте:
- `[Auth]` - логи автентифікації
- `Login error:` - помилки входу
- `Registration error:` - помилки реєстрації

### Мобільний додаток
Відкрийте консоль розробника в Expo:
- `[Auth]` - логи контексту автентифікації
- `[AXIOS]` - логи HTTP запитів

### Supabase
1. Відкрийте Supabase Dashboard
2. Перейдіть до "Logs" в лівій панелі
3. Перегляньте логи API та Database

## 6. Наступні кроки

Після успішного тестування базової автентифікації:

1. **Додайте більше тестових даних:**
   - Створіть кілька автомобілів для тестового користувача
   - Додайте тестові заявки на пробіг

2. **Протестуйте інші функції:**
   - Створення та редагування автомобілів
   - Подача заявок на пробіг
   - Перегляд історії

3. **Оптимізуйте продуктивність:**
   - Додайте кешування
   - Оптимізуйте запити до бази даних
   - Мінімізуйте кількість API викликів

4. **Покращте безпеку:**
   - Додайте валідацію даних
   - Реалізуйте refresh токени
   - Додайте rate limiting

## 7. Контрольний список

- [ ] SQL скрипт виконано в Supabase
- [ ] Таблиці створені правильно
- [ ] Тестовий користувач існує
- [ ] Сервер запускається без помилок
- [ ] API endpoints відповідають правильно
- [ ] Мобільний додаток підключається до сервера
- [ ] Автентифікація працює
- [ ] Дані користувача відображаються правильно
- [ ] Логи не містять критичних помилок

---

**Важливо:** Зберігайте цей файл та регулярно оновлюйте його на основі нових знахідок та змін в системі.