# План доопрацювання та синхронізації функціоналу (Web vs Mobile)

Цей документ сформовано на основі аудиту поточної кодової бази станом на 2026-02-05. Мета — забезпечити паритет функціональності між Web та Mobile додатками та "довести до розуму" кабінет клієнта.

## 1. Синхронізація Mobile App (React Native) з Web

### 1.1. Завершення запису (Appointment Completion)
**Проблема:** У Web майстер може завершити запис із введенням пробігу, додаванням запчастин (вручну або через OCR) та нотатками. У Mobile є лише зміна статусу на `completed`.
**Задачі:**
- [ ] Створити екран/модалку `CompleteAppointmentScreen` у Mobile.
- [ ] Додати поля: `completion_mileage`, `completion_notes`.
- [ ] Додати секцію "Використані запчастини" (список + додавання).
- [ ] Інтегрувати існуючий компонент `PartPhotoInput` (OCR) у флоу завершення запису.
- [ ] Викликати API `PUT /api/appointments/:id/status` з розширеним пейлоадом.

### 1.2. Вибір майстра (Relationships)
**Проблема:** У Web клієнт при записі бачить "Моїх механіків" (фільтр по `relationships`). У Mobile список майстрів вантажиться просто по місту/всіх, ігноруючи персональні зв'язки.
**Задачі:**
- [ ] Додати в `appointmentsService.js` метод `listMyMechanics()`.
- [ ] Оновити `CreateAppointmentScreen`: додати таб/фільтр "Мої майстри" vs "Всі".
- [ ] Відображати статус ("Запрошено", "Активний") біля майстра.

### 1.3. Експорт Сервісної Книжки
**Проблема:** Web має генерацію PDF. Mobile показує список, але не має кнопки "Завантажити/Поділитись PDF".
**Задачі:**
- [ ] Додати кнопку "Share PDF" у `ServiceHistoryScreen`.
- [ ] Використати `expo-print` / `expo-sharing` для генерації PDF (або викликати бекенд-ендпоінт, якщо він з'явиться, наразі Web генерує клієнтськи через `jspdf`).
- [ ] **Рекомендація:** Перенести генерацію PDF на сервер (`/api/reports/service-history/:vin`), щоб обидва клієнти тягнули файл.

## 2. Доопрацювання Web (Client Cabinet)

### 2.1. Мої Запчастини (My Parts) & OCR
**Проблема:** Сторінка існує, OCR працює (через API), але кнопка "Зберегти" — це `alert('Demo')`. Немає зв'язку з реальним збереженням.
**Задачі:**
- [ ] Реалізувати бекенд-ендпоінт `POST /api/vehicle-parts` (якщо відсутній) або розширити `POST /api/appointments/:id/parts`.
- [ ] У `MyParts.jsx`: додати вибір автомобіля (dropdown) при додаванні запчастини.
- [ ] Зв'язати кнопку "Зберегти" з API.

### 2.2. Страхування (Insurance)
**Проблема:** Є UI `InsuranceManagement.jsx`, але сервер не має роутів для страхування. Це "мертва" фіча.
**Задачі:**
- [ ] **Варіант А (швидкий):** Приховати розділ "Страхування" в меню, поки немає бекенду.
- [ ] **Варіант Б (правильний):** Створити таблицю `insurances`, CRUD-контролер та роути на сервері.

### 2.3. Двофакторна аутентифікація (2FA)
**Проблема:** Є UI-заглушки.
**Задачі:**
- [ ] Перевірити роботоздатність `/api/auth/2fa` (на сервері код є).
- [ ] Підключити реальні виклики в `TwoFactorAuth.jsx`.

## 3. Загальні покращення (Shared)

### 3.1. Статуси записів
**Статус:** Виконано (Web приведено до `confirmed`/`in_progress`).
**Наступні кроки:**
- [ ] Перевірити, чи Mobile коректно відображає кольори для `in_progress` (snake_case).

### 3.2. Нагадування (Reminders)
**Проблема:** Mobile має локальні нагадування + список. Web не має інтерфейсу для нагадувань.
**Задачі:**
- [ ] Додати сторінку "Нагадування" у Web (список ТО, страховок).
- [ ] Синхронізувати налаштування нагадувань через сервер.

### 3.3. Регламент ТО (Maintenance Schedule)
**Мета:** Розробити та реалізувати повноцінний графік обслуговування авто (регламент) з пунктами, нормами та нагадуваннями.
**Задачі:**
- [ ] **Database:** Створити таблицю `maintenance_schedules` (vehicle_id, service_item, interval_km, interval_months, last_service_date, last_service_mileage).
- [ ] **Backend:** Реалізувати CRUD API для регламенту (`/api/maintenance`).
- [ ] **Logic:** Реалізувати логіку розрахунку "наступного ТО" на основі пробігу/часу.
- [ ] **UI (Web/Mobile):** Екран "Регламент ТО" з можливістю редагування пунктів (наприклад, "Заміна масла" кожні 10 тис. км).
- [ ] **Notifications:** Автоматичне створення нагадувань при наближенні терміну.

## Пріоритет виконання (Roadmap)

1. **Тиждень 1: Mobile Parity (Завершення запису)** — критично для майстрів.
2. **Тиждень 1: Web Fixes (My Parts)** — щоб клієнти могли реально користуватися OCR.
3. **Тиждень 2: Relationships (Mobile)** — для зручності повторних записів.
4. **Тиждень 2: Insurance/Reminders** — розширення функціоналу.
