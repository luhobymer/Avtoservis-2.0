# Посібник розробника Avtoservis

## Загальні принципи розробки

### 1. Сканування файлів
- Перескануй файли додатка і запам'ятай, щоб не перевіряти їх при кожній задачі
- Перевіряй тільки ті файли, які бачиш що змінились
- Використовуй історію змін для оптимізації роботи

### 2. Аналіз історії
- Передивляйся історію того що робилось раніше
- Не повторюй помилки в нових завданнях
- Враховуй попередні рішення та підходи

### 3. Тип додатка
- Пам'ятай що створюємо мобільний додаток
- Додаток буде викладено на Google Play та App Store
- Забезпечуй доступ через звичайний браузер
- Враховуй специфіку мобільної розробки

### 4. Інтернаціоналізація
- Не забувай про переклад
- Підтримуй багатомовність (українська, російська, англійська)
- Перевіряй наявність перекладів для нових функцій

### 5. Робота з базою даних
- Для змін в БД (політики, функції, структури) надавай SQL запити
- Не використовуй Docker для міграцій
- Всі зміни БД виконуються вручну через SQL
- Не змінюй дані, тільки структуру

### 6. Робота з документами
- Читай та редагуй файли ТЗ
- Оновлюй файли аналізу
- Ведь історію змін
- Документуй всі важливі рішення

### 7. Якість коду
- Перевіряй файл на синтаксис перед редагуванням
- Перевіряй файл на помилки після редагування
- Валідуй код на відповідність стандартам
- Тестуй функціональність після змін

## Налаштування проекту

### 1. Налаштування Supabase

#### Крок 1: Виконання SQL скрипта
1. Відкрийте Supabase Dashboard: https://supabase.com/dashboard
2. Перейдіть до вашого проекту
3. Відкрийте SQL Editor (ліва панель)
4. Скопіюйте весь вміст файлу `SUPABASE_SETUP.sql`
5. Вставте в SQL Editor та натисніть "Run"
6. Переконайтеся, що всі команди виконались без помилок

#### Крок 2: Перевірка створених таблиць
Виконайте в SQL Editor:
```sql
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN ('users', 'vehicles', 'mileage_requests');
```

Повинні з'явитися всі три таблиці.

#### Крок 3: Перевірка тестового користувача
Виконайте в SQL Editor:
```sql
SELECT id, email, name, role, created_at 
FROM public.users 
WHERE email = 'test@example.com';
```

Повинен з'явитися тестовий користувач.

### 2. Тестування серверної частини

#### Крок 1: Запуск сервера
```bash
cd server
npm start
```

Сервер повинен запуститися на порту 3000.

#### Крок 2: Тестування реєстрації (якщо потрібно)
```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"newuser@example.com","password":"password123","role":"client"}'
```

#### Крок 3: Тестування входу
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'
```

#### Крок 4: Тестування захищених маршрутів
```bash
# Замініть YOUR_JWT_TOKEN на отриманий токен
curl -X GET http://localhost:3000/api/auth/me \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### 3. Налаштування мобільного додатка

#### Крок 1: Встановлення залежностей
```bash
cd mobile
npm install
```

#### Крок 2: Налаштування змінних середовища
Створіть файл `.env` в папці `mobile/` з наступним вмістом:
```
API_BASE_URL=http://localhost:3000/api
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_anon_key
```

#### Крок 3: Запуск додатка
```bash
# Для розробки
npx expo start

# Для Android
npx expo start --android

# Для iOS
npx expo start --ios

# Для веб
npx expo start --web
```

### 4. Налаштування веб-клієнта (відкладено)

**УВАГА**: Робота над веб-версією відкладена до готовності мобільного додатка.

#### Крок 1: Встановлення залежностей
```bash
cd client
npm install
```

#### Крок 2: Запуск розробницького сервера
```bash
npm run dev
```

## Структура проекту

```
Avtoservis/
├── mobile/          # Мобільний додаток (React Native/Expo)
├── server/          # API сервер (Node.js/Express)
├── client/          # Веб-клієнт (React/Vite) - ВІДКЛАДЕНО
├── docs/            # Документація
├── supabase/        # Конфігурація Supabase
└── mysql_export/    # Експорт MySQL БД
```

## Команди для розробки

### Мобільний додаток
```bash
cd mobile

# Запуск в режимі розробки
npx expo start

# Очищення кешу
npx expo start --clear

# Тестування
npm test

# Лінтинг
npm run lint

# Збірка для продакшну
npx expo build:android
npx expo build:ios
```

### Сервер
```bash
cd server

# Запуск в режимі розробки
npm run dev

# Запуск в продакшні
npm start

# Тестування
npm test

# Лінтинг
npm run lint
```

## Безпека

### Основні принципи
- Ніколи не зберігай секретні ключі в коді
- Використовуй змінні середовища для конфігурації
- Валідуй всі вхідні дані
- Використовуй HTTPS в продакшні
- Регулярно оновлюй залежності

### Автентифікація
- Використовуй JWT токени з обмеженим терміном дії
- Реалізуй refresh токени
- Додай двофакторну автентифікацію
- Логуй всі спроби входу

### Авторизація
- Перевіряй права доступу на кожному запиті
- Використовуй принцип найменших привілеїв
- Розділяй ролі користувачів

## Тестування

### Типи тестів
- **Unit тести**: Тестування окремих функцій та компонентів
- **Integration тести**: Тестування взаємодії між компонентами
- **E2E тести**: Тестування повного користувацького сценарію

### Запуск тестів
```bash
# Всі тести
npm test

# Тести з покриттям
npm run test:coverage

# Тести в режимі спостереження
npm run test:watch
```

## Розгортання

### Мобільний додаток
1. Збірка для Android: `npx expo build:android`
2. Збірка для iOS: `npx expo build:ios`
3. Публікація в магазинах додатків

### Сервер
1. Налаштування продакшн середовища
2. Встановлення залежностей: `npm ci --production`
3. Запуск: `npm start`
4. Налаштування reverse proxy (nginx)
5. Налаштування SSL сертифікатів

## Моніторинг та логування

### Логування
- Використовуй структуроване логування (JSON)
- Логуй помилки, попередження та важливі події
- Не логуй чутливі дані (паролі, токени)

### Моніторинг
- Відстежуй продуктивність додатка
- Моніторь використання ресурсів сервера
- Налаштуй алерти для критичних помилок

## Підтримка та оновлення

### Регулярні завдання
- Оновлення залежностей
- Резервне копіювання бази даних
- Перевірка безпеки
- Аналіз продуктивності

### Версіонування
- Використовуй семантичне версіонування (SemVer)
- Веди changelog для кожної версії
- Тегуй релізи в Git