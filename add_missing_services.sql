-- ========================================
-- ДОДАВАННЯ ВІДСУТНІХ ПОСЛУГ В ТАБЛИЦЮ SERVICES
-- ========================================

-- Перевіряємо поточні послуги
SELECT name, category, base_price, duration FROM services ORDER BY name;

-- Додаємо відсутні послуги для повного покриття
INSERT INTO services (id, name, description, base_price, duration, category) VALUES
-- Основні послуги технічного обслуговування
('aaaa5555-5555-5555-5555-555555555555', 'Заміна повітряного фільтра', 'Заміна повітряного фільтра двигуна', 350.00, 20, 'Технічне обслуговування'),
('bbbb6666-6666-6666-6666-666666666666', 'Заміна паливного фільтра', 'Заміна фільтра паливної системи', 450.00, 30, 'Технічне обслуговування'),
('cccc7777-7777-7777-7777-777777777777', 'Заміна свічок запалювання', 'Заміна комплекту свічок запалювання', 600.00, 45, 'Технічне обслуговування'),

-- Діагностичні послуги
('dddd8888-8888-8888-8888-888888888888', 'Діагностика гальмівної системи', 'Перевірка стану гальмівної системи', 400.00, 30, 'Діагностика'),
('eeee9999-9999-9999-9999-999999999999', 'Діагностика підвіски', 'Комплексна перевірка підвіски автомобіля', 500.00, 45, 'Діагностика'),
('ffff0000-0000-0000-0000-000000000000', 'Комп\'ютерна діагностика', 'Повна комп\'ютерна діагностика всіх систем', 800.00, 60, 'Діагностика'),

-- Ремонт гальмівної системи
('gggg1111-1111-1111-1111-111111111111', 'Заміна гальмівних дисків', 'Заміна передніх або задніх гальмівних дисків', 1500.00, 120, 'Гальмівна система'),
('hhhh2222-2222-2222-2222-222222222222', 'Прокачка гальмівної системи', 'Заміна гальмівної рідини та прокачка системи', 400.00, 30, 'Гальмівна система'),

-- Ремонт підвіски
('iiii3333-3333-3333-3333-333333333333', 'Заміна амортизаторів', 'Заміна передніх або задніх амортизаторів', 2000.00, 180, 'Підвіска'),
('jjjj4444-4444-4444-4444-444444444444', 'Заміна стійок стабілізатора', 'Заміна стійок стабілізатора поперечної стійкості', 800.00, 60, 'Підвіска'),

-- Ремонт двигуна
('kkkk5555-5555-5555-5555-555555555555', 'Заміна ременя ГРМ', 'Заміна ременя газорозподільного механізму', 2500.00, 240, 'Двигун'),
('llll6666-6666-6666-6666-666666666666', 'Заміна водяної помпи', 'Заміна насоса системи охолодження', 1800.00, 180, 'Двигун'),

-- Електрика та електроніка
('mmmm7777-7777-7777-7777-777777777777', 'Заміна акумулятора', 'Заміна акумуляторної батареї', 300.00, 15, 'Електрика'),
('nnnn8888-8888-8888-8888-888888888888', 'Ремонт генератора', 'Діагностика та ремонт генератора', 1200.00, 120, 'Електрика'),

-- Кузовні роботи
('oooo9999-9999-9999-9999-999999999999', 'Полірування кузова', 'Професійне полірування лакофарбового покриття', 1500.00, 180, 'Кузовні роботи'),
('pppp0000-0000-0000-0000-000000000000', 'Антикорозійна обробка', 'Обробка кузова антикорозійними засобами', 2000.00, 240, 'Кузовні роботи'),

-- Шиномонтаж
('qqqq1111-1111-1111-1111-111111111111', 'Заміна шин', 'Зняття та встановлення шин', 200.00, 30, 'Шиномонтаж'),
('rrrr2222-2222-2222-2222-222222222222', 'Балансування коліс', 'Балансування коліс на стенді', 300.00, 45, 'Шиномонтаж'),

-- Кондиціонер та клімат
('ssss3333-3333-3333-3333-333333333333', 'Заправка кондиціонера', 'Заправка системи кондиціонування фреоном', 800.00, 60, 'Кондиціонер'),
('tttt4444-4444-4444-4444-444444444444', 'Чистка кондиціонера', 'Антибактеріальна обробка системи кондиціонування', 600.00, 45, 'Кондиціонер')

ON CONFLICT (id) DO NOTHING;

-- Перевіряємо результат
SELECT 
    category,
    COUNT(*) as services_count,
    AVG(base_price) as avg_price,
    AVG(duration) as avg_duration
FROM services 
GROUP BY category 
ORDER BY category;

-- Загальна статистика
SELECT 
    COUNT(*) as total_services,
    MIN(base_price) as min_price,
    MAX(base_price) as max_price,
    AVG(base_price) as avg_price,
    MIN(duration) as min_duration,
    MAX(duration) as max_duration,
    AVG(duration) as avg_duration
FROM services;

-- Перевіряємо покриття для appointments
SELECT 
    a.service_type,
    COUNT(*) as appointments_count,
    CASE 
        WHEN s.name IS NOT NULL THEN 'Є відповідна послуга'
        ELSE 'ВІДСУТНЯ ПОСЛУГА'
    END as service_coverage
FROM appointments a
LEFT JOIN services s ON a.service_type = s.name
GROUP BY a.service_type, s.name
ORDER BY appointments_count DESC;